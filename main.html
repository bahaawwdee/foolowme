<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Follow Me</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet"/>
  <style>
    body { font-family: 'Tajawal', sans-serif; }
    input::-webkit-inner-spin-button,
    input::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    .toast {
      position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
      background: rgba(0,0,0,0.7); color: #fff; padding: .75rem 1.25rem;
      border-radius: .5rem; opacity: 0; transition: opacity .3s; z-index: 999;
    }
    .toast.show { opacity: 1; }
    /* Overlay to freeze UI */
    #freezeOverlay {
      position: fixed; inset: 0; background: rgba(255,255,255,0.5);
      z-index: 998; display: none;
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-tr from-green-100 via-blue-100 to-purple-100 flex items-center justify-center p-4">

  <!-- freeze overlay -->
  <div id="freezeOverlay"></div>
  <!-- toast notification -->
  <div id="toast" class="toast"></div>

  <div class="w-full max-w-lg bg-white/30 backdrop-blur-md rounded-3xl shadow-lg overflow-hidden">
    <!-- رأس مع زر الملف الشخصي -->
    <header class="flex justify-between items-center px-6 py-4 bg-white/20 backdrop-blur-sm">
      <div class="flex items-center space-x-2">
        <img src="l.png" alt="Logo" class="h-8"/>
        <h1 class="text-green-800 text-2xl font-semibold">Follow Me</h1>
      </div>
      <button id="profileBtn" class="p-2 bg-white/40 rounded-full hover:bg-white/60 transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-800" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M5.121 17.804A13.937 13.937 0 0112 15c2.54 0 4.914.736 6.879 2M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
        </svg>
      </button>
    </header>

    <main class="p-8 space-y-6">
      <!-- توست -->
      <!-- (already above) -->

      <!-- رصيد وشحن -->
      <div class="flex justify-between items-center">
        <div class="text-gray-700 font-medium">الرصيد: <span id="balance">0</span> ج</div>
        <button onclick="location.href='recharge.html'"
                class="py-2 px-5 bg-green-500/70 hover:bg-green-500 text-white rounded-lg transition">
          شحن الرصيد
        </button>
      </div>

      <!-- نموذج الطلب -->
      <form id="orderForm" class="space-y-5">
        <!-- اختيار منصة -->
        <div>
          <p class="mb-2 text-gray-800 font-semibold">اختر المنصة:</p>
          <div id="services" class="grid grid-cols-2 gap-4">
            <div data-value="facebook" class="service-card bg-white/20 backdrop-blur-sm border border-white/40 rounded-xl p-4 flex items-center cursor-pointer hover:shadow-md transition">
              <img src="f.jfif" class="h-6 w-6" alt="فيسبوك"/>
              <span class="mr-2 text-gray-700">فيسبوك</span>
            </div>
            <div data-value="tiktok" class="service-card bg-white/20 backdrop-blur-sm border border-white/40 rounded-xl p-4 flex items-center cursor-pointer hover:shadow-md transition">
              <img src="t.jfif" class="h-6 w-6" alt="تيك توك"/>
              <span class="mr-2 text-gray-700">تيك توك</span>
            </div>
            <div data-value="instagram" class="service-card bg-white/20 backdrop-blur-sm border border-white/40 rounded-xl p-4 flex items-center cursor-pointer hover:shadow-md transition">
              <img src="i.png" class="h-6 w-6" alt="انستجرام"/>
              <span class="mr-2 text-gray-700">انستجرام</span>
            </div>
            <div data-value="youtube" class="service-card bg-white/20 backdrop-blur-sm border border-white/40 rounded-xl p-4 flex items-center cursor-pointer hover:shadow-md transition">
              <img src="y.jfif" class="h-6 w-6" alt="يوتيوب"/>
              <span class="mr-2 text-gray-700">يوتيوب</span>
            </div>
          </div>
          <input type="hidden" id="serviceInput" name="service" required/>
        </div>

        <!-- الرابط -->
        <div>
          <label for="url" class="block mb-1 text-gray-700 font-medium">الرابط:</label>
          <input type="url" id="url" name="url" required placeholder="https://"
                 class="w-full p-3 bg-white/20 backdrop-blur-sm border border-white/40 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-300"/>
        </div>

        <!-- العدد والسعر -->
        <div class="grid grid-cols-2 gap-4 items-end">
          <div>
            <label for="amount" class="block mb-1 text-gray-700 font-medium">العدد:</label>
            <input type="text" id="amount" name="amount" value="1000"
                   inputmode="numeric" pattern="\d*" required placeholder="أرقام إنجليزية فقط"
                   class="w-full p-3 bg-white/20 backdrop-blur-sm border border-white/40 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-300"/>
          </div>
          <div class="text-gray-800 font-medium">
            السعر: <span id="price">0</span> ج
          </div>
        </div>

        <!-- زر الإرسال -->
        <button type="submit" id="submitBtn"
                class="w-full py-3 bg-green-500/70 hover:bg-green-500 text-white font-semibold rounded-lg transition">
          تقديم الطلب
        </button>
      </form>

      <!-- زر متابعة الطلبات -->
      <button id="trackOrdersBtn" class="w-full py-3 bg-blue-500/70 hover:bg-blue-500 text-white font-semibold rounded-lg transition">
        متابعة الطلبات
      </button>
    </main>

    <footer class="bg-white/20 backdrop-blur-sm text-center p-4 text-gray-600 text-sm">
      جميع الحقوق محفوظة © 2025
    </footer>
  </div>

  <!-- مودال الخدمات -->
  <div id="servicesModal" class="fixed inset-0 bg-black/50 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-xl p-6 w-96 space-y-4">
      <h3 class="text-lg font-semibold text-gray-800">اختر الخدمة</h3>
      <div id="servicesList" class="space-y-3"></div>
      <button onclick="closeServiceModal()"
              class="mt-4 w-full py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition">
        إغلاق
      </button>
    </div>
  </div>

  <!-- مودال متابعة الطلبات -->
  <div id="orderModal" class="fixed inset-0 bg-black/50 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-xl p-6 w-96 space-y-4">
      <h3 class="text-lg font-semibold text-gray-800">طلباتك السابقة</h3>
      <div id="ordersList" class="space-y-3"></div>
      <button onclick="closeOrderModal()"
              class="mt-4 w-full py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">
        إغلاق
      </button>
    </div>
  </div>

  <script>
    // toast helper
    function showToast(msg) {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.classList.add('show');
      setTimeout(() => t.classList.remove('show'), 3000);
    }
    // freeze UI
    function freezeUI() {
      document.getElementById('freezeOverlay').style.display = 'block';
    }

    // ensure user
    if (!localStorage.getItem('user')) location.href = 'index.html';

    // balance
    const getBalance = () => +localStorage.getItem('balance') || 0;
    const setBalance = v => localStorage.setItem('balance', v);
    const refreshBal = () => document.getElementById('balance').textContent = getBalance();
    refreshBal();

    // services data
    const platformServices = {
      facebook: [
        {name:"زيادة متابعين",value:"followers",price:25},
        {name:"لايكات صفحة",value:"page_likes",price:12},
        {name:"تعليقات عربية",value:"comments",price:20},
        {name:"لايكات منشورات",value:"post_likes",price:7}
      ],
      tiktok: [
        {name:"زيادة متابعين",value:"followers",price:28},
        {name:"لايكات فيديو",value:"video_likes",price:9},
        {name:"مشاهدات",value:"views",price:6}
      ],
      instagram: [
        {name:"زيادة متابعين",value:"followers",price:27},
        {name:"لايكات منشورات",value:"likes",price:10},
        {name:"تعليقات",value:"comments",price:18}
      ],
      youtube: [
        {name:"زيادة مشتركين",value:"subscribers",price:30},
        {name:"مشاهدات فيديو",value:"views",price:8},
        {name:"لايكات",value:"likes",price:10}
      ]
    };

    let selPlat, selServ, selPrice;

    // open services modal
    document.querySelectorAll('.service-card').forEach(c => {
      c.addEventListener('click', () => {
        selPlat = c.dataset.value;
        const list = document.getElementById('servicesList');
        list.innerHTML = '';
        platformServices[selPlat].forEach(s => {
          const btn = document.createElement('button');
          btn.textContent = `${s.name} (${s.price} ج /1000)`;
          btn.className = 'w-full py-2 bg-green-100 hover:bg-green-200 rounded-lg text-right';
          btn.onclick = () => {
            selServ = s.value;
            selPrice = s.price;
            document.getElementById('serviceInput').value = `${selPlat}-${selServ}`;
            updatePrice();
            closeServiceModal();
          };
          list.appendChild(btn);
        });
        document.getElementById('servicesModal').classList.remove('hidden');
      });
    });
    function closeServiceModal() {
      document.getElementById('servicesModal').classList.add('hidden');
    }

    // price calc
    function updatePrice() {
      const amt = parseInt(document.getElementById('amount').value) || 0;
      document.getElementById('price').textContent =
        (!selServ || amt < 1000) ? '0' : ((amt/1000)*selPrice).toFixed(2);
    }
    document.getElementById('amount').addEventListener('input', updatePrice);

    // save order
    function saveOrder(o) {
      const arr = JSON.parse(localStorage.getItem('orders')||'[]');
      arr.push(o);
      localStorage.setItem('orders', JSON.stringify(arr));
    }

    // submit
    document.getElementById('orderForm').addEventListener('submit', e => {
      e.preventDefault();
      const url = document.getElementById('url').value.trim();
      if (!url) {
        return showToast('الرجاء إدخال رابط صحيح');
      }
      const amt = parseInt(document.getElementById('amount').value) || 0;
      const cost = parseFloat(document.getElementById('price').textContent) || 0;
      const orders = JSON.parse(localStorage.getItem('orders')||'[]');
      if (orders.some(o => o.url === url && o.service === selServ && o.remaining > 0)) {
        return showToast('هذا الطلب قيد التنفيذ بالفعل');
      }
      if (!selServ || amt < 1000 || getBalance() < cost) {
        return showToast('راجع بيانات الطلب أو الرصيد');
      }
      // success
      freezeUI();
      showToast('تم تقديم الطلب بنجاح');
      setBalance(getBalance() - cost);
      refreshBal();
      const id = Date.now();
      const totalSec = (Math.floor(Math.random()*24) + 1) * 3600;
      saveOrder({id,url,service:selServ,cost,remaining: totalSec});
      setTimeout(() => location.reload(), 3000);
    });

    // track orders
    document.getElementById('trackOrdersBtn').onclick = () => {
      document.getElementById('orderModal').classList.remove('hidden');
      renderOrders();
    };
    function closeOrderModal() {
      document.getElementById('orderModal').classList.add('hidden');
    }

    // render orders
    function renderOrders() {
      const listEl = document.getElementById('ordersList');
      listEl.innerHTML = '';
      const orders = JSON.parse(localStorage.getItem('orders')||'[]');
      orders.forEach(o => {
        const div = document.createElement('div');
        div.className = 'rounded-xl p-4 mb-3 bg-white/40';
        div.innerHTML = `
          <div class="flex justify-between items-center">
            <span>طلب #${o.id}</span>
            <span id="cd-${o.id}">${formatTime(o.remaining)}</span>
          </div>
          <div id="status-${o.id}" class="mt-2 text-red-600 font-semibold"></div>
        `;
        listEl.appendChild(div);
        startCd(o);
      });
    }

    function startCd(o) {
      let rem = o.remaining;
      const cdEl = document.getElementById(`cd-${o.id}`);
      const statusEl = document.getElementById(`status-${o.id}`);
      const iv = setInterval(() => {
        if (rem <= 0) {
          clearInterval(iv);
          cdEl.textContent = '00:00:00';
          statusEl.textContent = 'فشل الرابط غير صالح';
          // refund
          setBalance(getBalance() + o.cost);
          refreshBal();
          // remove
          const arr = JSON.parse(localStorage.getItem('orders')||'[]')
                       .filter(x => x.id !== o.id);
          localStorage.setItem('orders', JSON.stringify(arr));
        } else {
          rem--;
          cdEl.textContent = formatTime(rem);
        }
      }, 1000);
    }

    function formatTime(sec) {
      const h = Math.floor(sec/3600),
            m = Math.floor((sec%3600)/60),
            s = sec%60;
      return `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    }
  </script>
</body>
</html>
